<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ß–µ–∫ –õ–∏—Å—Ç | FoodLine</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>tailwind.config = { darkMode: 'class', theme: { extend: { colors: { slate: { 50: '#f8fafc', 800: '#1e293b', 900: '#0f172a' } } } } }</script>
    <style>
        :root { --bg-color: #f8fafc; --card-bg: #fff; --text: #1e293b; }
        .dark { --bg-color: #0f172a; --card-bg: #1e293b; --text: #f1f5f9; }
        body { background-color: var(--bg-color); color: var(--text); padding-bottom: 6rem; transition: 0.3s; }
        .card { background-color: var(--card-bg); transition: 0.3s; }
        .checklist-item { border: 1px solid #e2e8f0; transition: 0.2s; }
        .dark .checklist-item { border-color: #334155; }
        .checklist-item.completed { background-color: rgba(16, 185, 129, 0.1); border-color: #10b981; }
        .checkbox-icon { width: 1.5rem; height: 1.5rem; border: 2px solid #cbd5e1; border-radius: 0.375rem; display: flex; align-items: center; justify-content: center; }
        .checklist-item.completed .checkbox-icon { background-color: #10b981; border-color: #10b981; }
        .checklist-item.completed .checkbox-icon::after { content: '‚úî'; color: white; font-size: 14px; font-weight: bold; }
        .nav-button.active { background-color: #059669; color: white; }
        .modal-overlay { background-color: rgba(0,0,0,0.6); backdrop-filter: blur(2px); z-index: 50; }
        .spinner { border: 3px solid rgba(0,0,0,0.1); width: 24px; height: 24px; border-radius: 50%; border-left-color: #10b981; animation: spin 1s linear infinite; }
        @keyframes spin { 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="font-sans antialiased">
    <div id="toast-container" class="fixed top-4 right-4 z-[2000] flex flex-col gap-2"></div>
    <div class="container mx-auto max-w-3xl p-4">
        <header class="relative text-center mb-6">
            <a href="index.html" class="absolute top-0 left-0 p-2 bg-white dark:bg-slate-800 rounded-lg shadow-sm border border-slate-200 dark:border-slate-700 text-slate-500">–ú–µ–Ω—é</a>
            <h1 class="text-2xl font-bold">–ß–µ–∫ –õ–∏—Å—Ç</h1>
            <button id="themeToggle" class="absolute top-0 right-0 p-2 rounded-lg bg-white dark:bg-slate-800 shadow-sm text-slate-500">Theme</button>
        </header>

        <div class="mb-6 card p-4 rounded-xl shadow-sm border border-slate-200 dark:border-slate-700">
            <label class="block text-sm font-bold mb-2">–ö–æ–Ω—Ç—Ä–æ–ª–µ—Ä —è–∫–æ—Å—Ç—ñ:</label>
            <select id="employeeSelect" class="w-full p-3 border rounded-xl bg-transparent"><option value="">–û–±–µ—Ä—ñ—Ç—å...</option></select>
        </div>

        <nav class="grid grid-cols-3 gap-2 mb-6 p-1 bg-slate-100 dark:bg-slate-800 rounded-xl">
            <button data-view="start" class="nav-button active py-2 px-1 rounded-lg font-bold text-sm">–ü–æ—á–∞—Ç–æ–∫</button>
            <button data-view="during" class="nav-button py-2 px-1 rounded-lg font-bold text-sm">–ó–º—ñ–Ω–∞</button>
            <button data-view="end" class="nav-button py-2 px-1 rounded-lg font-bold text-sm">–ö—ñ–Ω–µ—Ü—å</button>
        </nav>

        <main>
            <section id="startShiftSection" class="view-section">
                <div class="card p-4 rounded-xl shadow border border-slate-200 dark:border-slate-700">
                    <div class="flex justify-between items-center mb-4"><h2 class="text-xl font-bold text-emerald-600">–ü–æ—á–∞—Ç–æ–∫ –∑–º—ñ–Ω–∏</h2><button onclick="resetSection('startShiftSection')" class="text-xs bg-orange-500 text-white px-3 py-1 rounded">–°–∫–∏–Ω—É—Ç–∏</button></div>
                    <ul class="space-y-3" id="list-start"></ul>
                </div>
            </section>
            <section id="duringShiftSection" class="view-section hidden">
                <div class="card p-4 rounded-xl shadow border border-slate-200 dark:border-slate-700">
                    <div class="flex justify-between items-center mb-4"><h2 class="text-xl font-bold text-blue-600">–ü—Ä–æ—Ç—è–≥–æ–º –∑–º—ñ–Ω–∏</h2><button onclick="resetSection('duringShiftSection')" class="text-xs bg-orange-500 text-white px-3 py-1 rounded">–°–∫–∏–Ω—É—Ç–∏</button></div>
                    <ul class="space-y-3" id="list-during"></ul>
                </div>
            </section>
            <section id="endShiftSection" class="view-section hidden">
                <div class="card p-4 rounded-xl shadow border border-slate-200 dark:border-slate-700">
                    <div class="flex justify-between items-center mb-4"><h2 class="text-xl font-bold text-sky-600">–ö—ñ–Ω–µ—Ü—å –∑–º—ñ–Ω–∏</h2><button onclick="resetSection('endShiftSection')" class="text-xs bg-orange-500 text-white px-3 py-1 rounded">–°–∫–∏–Ω—É—Ç–∏</button></div>
                    <ul class="space-y-3" id="list-end"></ul>
                </div>
            </section>
        </main>
    </div>

    <!-- Modals -->
    <div id="confirmationModal" class="hidden fixed inset-0 items-center justify-center modal-overlay p-4 z-50">
        <div class="card p-6 rounded-xl shadow-2xl w-full max-w-md flex flex-col max-h-[85vh]">
            <h3 class="text-xl font-bold mb-4 text-center">–ü—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è</h3>
            <div id="confirmationText" class="bg-slate-50 dark:bg-slate-800 p-4 rounded-lg overflow-y-auto mb-4 text-xs font-mono whitespace-pre-wrap flex-1"></div>
            <p id="sendMsg" class="text-center font-bold mb-2 min-h-[1.5em] text-emerald-600"></p>
            <div id="modalActions" class="flex flex-col gap-2">
                <button id="confirmSendBtn" class="w-full bg-emerald-600 hover:bg-emerald-700 text-white font-bold py-3 rounded-lg">‚úÖ –ù–∞–¥—ñ—Å–ª–∞—Ç–∏</button>
                <button onclick="closeModal('confirmationModal')" class="w-full border border-slate-300 py-3 rounded-lg font-bold">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
            </div>
            <div id="modalSpinner" class="hidden py-4 flex justify-center"><div class="spinner"></div></div>
        </div>
    </div>

    <script>
        const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwtN3ZNBAsj3XE-99NuX_iLaZDCqGtmM6baNfXDylPM1qqbasGeNGLfdc4vc73f5GPl/exec";
        const employees = ["–°–æ–±–æ—Ç–æ–≤–∏—á –õ.–ú.", "–û–≥–∞—Ä–∫–æ–≤–∞ –ú.–í.", "–Ü–Ω—à–∏–π"];
        const checklistItems = {
            start: [
                { id: 'start-1-1', text: '–ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —á–∏—Å—Ç–æ—Ç—É —Ç–∞ —Å–ø—Ä–∞–≤–Ω—ñ—Å—Ç—å –æ–±–ª–∞–¥–Ω–∞–Ω–Ω—è –≤ –ª–∞–±–æ—Ä–∞—Ç–æ—Ä—ñ—ó.', type: 'normal' },
                { id: 'start-1-2', text: '–ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—É —Å–æ—É—Å—ñ–≤ –ø—ñ—Å–ª—è –Ω—ñ—á–Ω–æ–≥–æ –æ—Ö–æ–ª–æ–¥–∂–µ–Ω–Ω—è (t ‚â§ 24¬∞C).', type: 'problem', btn: '‚ö†Ô∏è –í—ñ–¥—Ö–∏–ª–µ–Ω–Ω—è', fields: ['‚Ññ –ö–æ—Ç–ª–∞', '–°–æ—É—Å', '–¢–µ–º–ø ¬∞C'] },
                { id: 'start-1-4', text: '–ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –∂—É—Ä–Ω–∞–ª –∑–∞–º—ñ–Ω–∏ —Ñ—ñ–ª—å—Ç—Ä—ñ–≤ —Ñ—ñ–ª—å—Ç—Ä–∞ –Ω–∞ –í–ö-1.', type: 'normal' }
            ],
            during: [
                { id: 'during-1-1', text: '–ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –≥—ñ–≥—ñ—î–Ω—É –ø–µ—Ä—Å–æ–Ω–∞–ª—É (–æ–¥—è–≥, —à–∞–ø–æ—á–∫–∏, –ø—Ä–∏–∫—Ä–∞—Å–∏).', type: 'normal' },
                { id: 'during-1-2', text: '–ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –ø—ñ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω—É —Å–∏—Ä–æ–≤–∏–Ω—É –Ω–∞ –¥—ñ–ª—å–Ω–∏—Ü—é –ø—ñ–¥–≥–æ—Ç–æ–≤–∫–∏ —Å–∏—Ä–æ–≤–∏–Ω–∏ –Ω–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω—ñ—Å—Ç—å —ñ –±–µ–∑–ø–µ—á–Ω—ñ—Å—Ç—å (—Å—Ç–æ—Ä–æ–Ω–Ω—ñ –¥–æ–º—ñ—à–∫–∏, –∫–æ–Ω—Å–µ—Ä–≤–∞–Ω—Ç–∏, –ø–∞–∫—É–≤–∞–Ω–Ω—è, –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è).', type: 'normal' },
                { id: 'during-1-3', text: '–ü—Ä–æ–≤–µ—Å—Ç–∏ –µ–∫—Å–ø—Ä–µ—Å-—Ç–µ—Å—Ç –ø–æ–∫–∞–∑–Ω–∏–∫—ñ–≤ –≤–æ–¥–æ–ø—ñ–¥–≥–æ—Ç–æ–≤–∫–∏ (–•–í–û).', type: 'problem', btn: '‚ö†Ô∏è –í—ñ–¥—Ö–∏–ª–µ–Ω–Ω—è', fields: ['–ü–æ–∫–∞–∑–Ω–∏–∫', '–ó–Ω–∞—á–µ–Ω–Ω—è'] },
                { id: 'during-1-4', text: '–ü—Ä–æ–≤–µ—Å—Ç–∏ –ø–æ—Ç–æ—á–Ω–∏–π –∫–æ–Ω—Ç—Ä–æ–ª—å –±–µ–∑–ø–µ—á–Ω–æ—Å—Ç—ñ –ø—Ä–æ—Ü–µ—Å—É.', type: 'problem', btn: '‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º–∞', fields: ['–û–ø–∏—Å –ø–æ—Ä—É—à–µ–Ω–Ω—è'] },
                { id: 'during-1-5', text: '–í–∏–∫–æ–Ω–∞—Ç–∏ –¥–æ–¥–∞—Ç–∫–æ–≤—ñ –∑–∞–≤–¥–∞–Ω–Ω—è –∫–µ—Ä—ñ–≤–Ω–∏–∫–∞.', type: 'normal' },
                { id: 'during-1-6', text: '–í–∏–¥–∞—Ç–∏ –∫–æ–Ω—Å–µ—Ä–≤–∞–Ω—Ç–∏ –≤–∞—Ä–Ω–∏–∫–∞–º –ø—ñ–¥ –ø—ñ–¥–ø–∏—Å.', type: 'info', btn: 'üìù –ó–∞–ø–∏—Å–∞—Ç–∏', fields: ['–í–∞—Ä–Ω–∏–∫', '–ö–æ–Ω—Å–µ—Ä–≤–∞–Ω—Ç', '–ö—ñ–ª—å–∫—ñ—Å—Ç—å'] }
            ],
            end: [
                { id: 'end-1-1', text: '–ü—Ä–æ–≤–µ—Å—Ç–∏ –Ω–µ–æ–±—Ö—ñ–¥–Ω—ñ –∑–∞–º—ñ—Ä–∏ –¥–ª—è –í–°–Ü–• –≤–∞—Ä–æ–∫ –ø–µ—Ä–µ–¥ –ø–æ—Å—Ç–∞–Ω–æ–≤–∫–æ—é –Ω–∞ –æ—Ö–æ–ª–æ–¥–∂–µ–Ω–Ω—è.', type: 'normal' },
                { id: 'end-1-2', text: '–ü–æ–≤–µ—Ä–Ω—É—Ç–∏ –∑–∞–ª–∏—à–∫–∏ –∫–æ–Ω—Å–µ—Ä–≤–∞–Ω—Ç—ñ–≤ —Ç–∞ —ñ–Ω—à–∏—Ö –¢–ú–¶ –≤ –ª–∞–±–æ—Ä–∞—Ç–æ—Ä—ñ—é.', type: 'normal' },
                { id: 'end-1-3', text: '–ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —Å–∞–Ω—ñ—Ç–∞—Ä–Ω–∏–π —Å—Ç–∞–Ω —Ü–µ—Ö—É.', type: 'problem', btn: '‚ö†Ô∏è –ù–µ–∑–∞–¥–æ–≤—ñ–ª—å–Ω–æ', fields: ['–û–ø–∏—Å –ø—Ä–æ–±–ª–µ–º–∏'] },
                { id: 'end-1-4', text: '–ó–∞–ø–æ–≤–Ω–∏—Ç–∏ –∑–≤—ñ—Ç –ø—Ä–æ –Ω–µ–¥–æ–ª—ñ–∫–∏ —Ç–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏ –∑–º—ñ–Ω–∏.', type: 'normal' },
                { id: 'end-1-5', text: '–ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —Ü—ñ–ª—ñ—Å–Ω—ñ—Å—Ç—å —Å–∫–ª–∞ —Ç–∞ –ø–ª–∞—Å—Ç–∏–∫—É (–≤—ñ–¥—Å—É—Ç–Ω—ñ—Å—Ç—å –±–æ—é).', type: 'normal' }
            ]
        };

        const empSel = document.getElementById('employeeSelect');
        employees.forEach(e => empSel.add(new Option(e, e)));
        
        let pendingReportData = null;

        function init() {
            renderChecklist('start'); renderChecklist('during'); renderChecklist('end');
            document.body.addEventListener('click', handleClick);
            document.getElementById('themeToggle').onclick = () => { document.documentElement.classList.toggle('dark'); };
        }

        function renderChecklist(section) {
            const ul = document.getElementById(`list-${section}`);
            ul.innerHTML = checklistItems[section].map(item => `
                <li id="${item.id}" class="checklist-item p-3 rounded-xl flex flex-col cursor-pointer bg-slate-50 dark:bg-slate-800">
                    <div class="flex items-center justify-between check-trigger" data-id="${item.id}">
                        <div class="flex items-center"><div class="checkbox-icon mr-3"></div><span class="text-sm font-medium">${item.text}</span></div>
                    </div>
                </li>`).join('');
            const btn = document.createElement('div');
            btn.innerHTML = `<button onclick="prepareReport('${section}')" class="w-full mt-4 bg-emerald-600 hover:bg-emerald-700 text-white font-bold py-3 rounded-xl transition-colors">üì§ –í—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏ –∑–≤—ñ—Ç</button>`;
            ul.parentNode.appendChild(btn);
        }

        function handleClick(e) {
            if (e.target.closest('.nav-button')) {
                document.querySelectorAll('.view-section').forEach(el => el.classList.add('hidden'));
                document.querySelectorAll('.nav-button').forEach(b => b.classList.remove('active'));
                const view = e.target.closest('.nav-button').dataset.view;
                document.getElementById(`${view}ShiftSection`).classList.remove('hidden');
                e.target.closest('.nav-button').classList.add('active');
            }
            if (e.target.closest('.check-trigger')) {
                const el = document.getElementById(e.target.closest('.check-trigger').dataset.id);
                el.classList.toggle('completed');
            }
        }

        function resetSection(id) {
            if(confirm('–û—á–∏—Å—Ç–∏—Ç–∏ —Ä–æ–∑–¥—ñ–ª —Ç–∞ –∫–æ–Ω—Ç—Ä–æ–ª–µ—Ä–∞?')) {
                document.getElementById('employeeSelect').value = '';
                document.getElementById(id).querySelectorAll('.checklist-item').forEach(el => el.classList.remove('completed'));
            }
        }

        function prepareReport(section) {
            if(!empSel.value) { alert("–û–±–µ—Ä—ñ—Ç—å –∫–æ–Ω—Ç—Ä–æ–ª–µ—Ä–∞!"); return; }
            let report = "";
            document.querySelectorAll(`#list-${section} .checklist-item`).forEach(el => {
                const txt = el.querySelector('span').innerText;
                const status = el.classList.contains('completed') ? "‚úÖ" : "‚ùå";
                report += `${status} | ${txt}\n`;
            });
            pendingReportData = { type: 'checklist', employee: empSel.value, stage: section, report: report, reportText: report };
            document.getElementById('confirmationText').innerText = report;
            document.getElementById('confirmationModal').classList.remove('hidden');
            document.getElementById('confirmationModal').classList.add('flex');
            document.getElementById('modalActions').style.display = 'flex';
            document.getElementById('modalSpinner').classList.add('hidden');
        }

        async function executeSend() {
            document.getElementById('modalActions').style.display = 'none';
            document.getElementById('modalSpinner').classList.remove('hidden');
            try {
                await fetch(GOOGLE_SCRIPT_URL, { method: 'POST', mode: 'no-cors', body: JSON.stringify(pendingReportData) });
                document.getElementById('sendMsg').innerText = "‚úÖ –ù–∞–¥—ñ—Å–ª–∞–Ω–æ!";
                setTimeout(() => { closeModal('confirmationModal'); }, 1500);
            } catch(e) { alert("–ü–æ–º–∏–ª–∫–∞"); }
        }

        function closeModal(id) { document.getElementById(id).classList.add('hidden'); document.getElementById(id).classList.remove('flex'); }
        init();
    </script>
</body>
</html>
